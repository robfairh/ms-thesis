% see if this is compatible with \ref{eq:diffusion}
% eq 4.14 from \cite{leppanen_development_2007}
\begin{align}
\Sigma_{r,g} &= \Sigma_{a,g} + \sum_{g' \ne g} \Sigma_{s,g \rightarrow g'} = \Sigma_{t,g} - \Sigma_{s, g \rightarrow g}
\label{eq:removal}
\end{align}

\section{Diffusion Methods}
% this might go somewhere else, another chapter maybe

Neutron diffusion theory is based on the general transport theory.
It is one of the simplest means to solve neutron transport problems \cite{leppanen_development_2007}.
% Talk about computational advantages
Diffusion theory has its limitations, but it is widely and successfully used in various reactor-scale LWR calculations.
% Use of diffusion methods for HTGRs?: Advantages, disadvantages, history ...

Validity of the diffusion equation:

The diffusion approximation suggests that the current density ($J_g$) is proportional to the gradient of the flux ($\phi_g$)

\begin{align}
J_g &= -D_g \nabla \phi_g.
\label{eq:fick}
\end{align}

The validity of \ref{eq:fick} relies on the following approximations:

% check [7] \cite{leppanen_development_2007}

\begin{itemize}
	\item The angular flux does not depend strongly on the angular variables.
	\item The fission source is isotropic.
	\item The time derivative of the current density is small compared to the mean collision time.
	\item The anisotropic energy-transfer contribution can be ignored in group-to-group scattering.
\end{itemize}

% Section 4.IV.C \cite{duderstadt_nuclear_1976}
More detailed studies of the transport equation itself indicate that the assumption of weak angular dependence is violated in the following cases:
\begin{itemize}
    \item near boundaries or where material properties change dramatically
    \item near localized sources
    \item near strongly absorbing media
\end{itemize}

The first item in the list imposes the requirement that scattering be the dominant interaction process, and not highly anisotropic.
% I think the scattering in graphite is anisotropic ...
Diffusion calculations give good results in large, nearly homogeneous regions, where the spatial dependence
of the neutron flux is not too strong, i.e. where the flux gradient is small.

Problems may arise in the following cases:
\begin{itemize}
	\item Near vacuum boundaries and low-density material regions.
	\item Near high-absorbing materials, such as control rods or burnable absorber pins.
	\item In large material regions with highly anisotropic scattering properties, such as moderator channels filled with water.
\end{itemize}

The diffusion theory is best applied in geometries consisting of large homogeneous material regions without sharp spatial changes in the neutronic properties of the medium.
This is generally not the case for \glspl{LWR}.
The active core region is extremely complicated in detail, as there are hundreds of fuel assemblies, each consisting of tens to hundreds of fuel pins.
The geometrical scale of a system must be compared to the neutron mean free path between the
collisions.
In \glspl{LWR}, this is typically less that 1 cm for thermal neutrons and 5-10 cm for fast fission neutrons.
% Look for those numbers for HTGRs
% mean free path: \lambda = \Sigma_t^{-1}
% Migration length in a LWR is 6 cm while in a HTGR is 57 cm\cite{shenoy_htgr_2010} this could be wrong
In \glspl{HTGR} the mean free path in graphite is 3.9 cm. 0.3 cm in \glspl{LWR} \cite{gougar_high_2019}.

The neutron flux in such a complicated system is not a smoothly varying function of the spatial co-ordinates, especially at low energy.
The thermal flux reaches a peak near reflector regions at the core periphery.

The above difficulties make it impossible to use diffusion theory for detailed full-core calculations.
A widely used practical solution to the problem is to reduce the spatial detail of the geometry to a level where diffusion theory is applicable. The reduction has to be carried out in such a way that the diffusion calculation gives consistent results with the detailed transport theory calculation.
This procedure is known as homogenization [10].
The reactor core is described as a three-dimensional array of homogeneous macro-regions.
\cite{leppanen_development_2007}

% Heterogeneous calculations using moltres

It is well established that lattice fuel block calculations for HTRs with low-enriched uranium produce cross-sections that lead to larger errors in regions near the reflectors.
Instead, the preferred way to alleviate some of the error in the cross-sections is to allow better spectrum information to be transferred in the full core calculations through the use of a large number of coarse energy groups, for example with 26 groups.
\cite{oecd_nea_coupled_2020}

For the cross-section generation good agreement can be obtained using more groups (8-26).
Discretize in the axial dimension.
\cite{gougar_high_2019}.

% Impact of delayed neutrons in the calculations
% Section 4.3.2 of \cite{leppanen_development_2007}

Some small fraction of fission neutrons, typically 0.1-1.7\% is not emitted instantly, but after the radioactive decay of certain precursor fission product isotopes.
Despite their small flux contribution, the impact of delayed neutrons on reactor kinetics is essential.


\cite{leppanen_development_2007}

Comparison in moltres


Results
The presence of graphite causes relatively large uncertainties in neutronic calculations.
\cite{gougar_high_2019}

Important data
Flow reverses during LOFC \cite{gougar_high_2019}




\section{Serpent model}
% This will go into tools (tools is actually method)
In 2013, the IAEA launched the Coordinated Research Project (CRP) on Uncertainty Analysis in Modeling (UAM) to study uncertainty propagation in the High Temperature Gas-cooled Reactor (HTGR) analysis chain.

HTGR reactors require core simulation techniques not typically utilized in Light Water Reactor (LWR) analysis due to several unique features, such as double heterogeneous fuel design including tristructural isotropic (TRISO) fuel particles, large graphite quantities, and high operational temperatures.

\cite{bostelmann_criticality_2016}.

A major challenge for neutronics modeling is the double heterogenity present in HTGRs.

The issue of double heterogeneity arises from the introduction of the TRISO fuel particles into the reactor design.
These TRISO particles form the first level of heterogeneity, as they consist of four layers.
The second level of heterogeneity arises from the fuel elements themselves.
The TRISO particles are packed into fuel compacts, which are contained within fuel assemblies that are heterogeneous with the coolant, moderator, and reflector regions.

The computational time required to explicitly model individual TRISO particles in the reactor makes this approach time consuming, costly, and impractical for the majority of applications.
Applying a simple volume homogenization has proven to be insufficient for TRISO particle, due to the resonant self-shielding effect of the kernel and coated layers.

SERPENT is a continuous energy Monte Carlo reactor physics burnup calculation code, developed by VTT Technical Research Centre of Finland and distributed by RSICC in the United States.
SERPENT allows for the explicit modeling of TRISO fuel particles.

\cite{rahnema_whitepaper_2015}.


Talk about the double heterogeneity, that it is important to model it explicitly otherwise a homogenization yields wrong results.
Objective is to address the uncertainties due to double heterogeneity or self-shielding treatment.
cite \ref{strydom_results_2015}